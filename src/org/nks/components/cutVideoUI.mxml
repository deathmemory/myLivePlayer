<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark" 
		 xmlns:mx="library://ns.adobe.com/flex/mx" 
		 minWidth="400" minHeight="40"
		 creationComplete="group1_creationCompleteHandler(event)">
	<fx:Script>
		<![CDATA[
			import com.longtailvideo.jwplayer.events.MediaEvent;
			import com.longtailvideo.jwplayer.events.ViewEvent;
			import com.longtailvideo.jwplayer.player.Player;
			import com.longtailvideo.jwplayer.utils.Strings;
			
			import mx.controls.Button;
			import mx.controls.HSlider;
			import mx.core.UIComponent;
			import mx.events.FlexEvent;
			
			import spark.formatters.NumberFormatter;
			
			private var _player:Player;
			private var _duration:Number;
			
			private var _onDrag:Boolean = false;
			private var _bLeftBtn = true;
			
			protected function group1_creationCompleteHandler(event:FlexEvent):void
			{
				// TODO Auto-generated method stub
				lbtn.x = bgc.width * 1/3;
				rbtn.x = bgc.width * 2/3;
				
				var width:Number = bgc.width;
				bgc.percentWidth = 0;
				bgc.width = width;
				
				lbtn.addEventListener(MouseEvent.MOUSE_DOWN, lbtnDown);
				rbtn.addEventListener(MouseEvent.MOUSE_DOWN, rbtnDown);
				
				//bgc.stage.addEventListener(MouseEvent.MOUSE_MOVE, bgc_mouseMoveHandler);
			}
			
			public function init(player:Player):void
			{
				trace("ver: 1.2");
				_player = player;
				if (_player)
					this.visible = true;
				_player.addEventListener(MediaEvent.JWPLAYER_MEDIA_TIME, mediaHandler);
				_player.addEventListener(MediaEvent.JWPLAYER_MEDIA_VOLUME, volumeHandler);
				
				stage.addEventListener(MouseEvent.MOUSE_MOVE, bgc_mouseMoveHandler);
			}
			
			protected function volumeHandler(evt:MediaEvent):void 
			{
				trace("volume:" + evt.volume);
			}
			
			private function mediaHandler(evt:MediaEvent):void 
			{
				switch (evt.type) {
					case MediaEvent.JWPLAYER_MEDIA_TIME:
						//_player.removeEventListener(MediaEvent.JWPLAYER_MEDIA_TIME, mediaHandler);
						_duration = evt.duration;
						fgc.width = bgc.width * (evt.position / evt.duration);
						setSliderTime(evt.position, evt.duration);
						break;
				}
			}
			
			private function setSliderTime(pos:Number, dur:Number):void
			{
				posTime.text = Strings.digits(pos);
				durTime.text = Strings.digits(dur);
			}
			
			protected function doThg_clickHandler(event:MouseEvent):void
			{
				_player.seek(293);
			}
			
			private function startMove(event:Event):void  
			{  
				var component:UIComponent = event.currentTarget as UIComponent;
				stage.addEventListener(MouseEvent.MOUSE_UP, this.stopMove);
				
				if ( _bLeftBtn ) 
				{
					var rpoint:Point = rbtn.contentToLocal(new Point(rbtn.x, rbtn.y));
					var bgcpoint:Point = bgc.contentToLocal(new Point(bgc.x, bgc.y));
					component.startDrag(false, new Rectangle(0 - lbtn.width , 0, rpoint.x - bgcpoint.x, 0));
				}
				else
				{
					var lpoint:Point = lbtn.contentToLocal(new Point(lbtn.x, lbtn.y));
					var bgcpoint:Point = bgc.contentToLocal(new Point(bgc.x, bgc.y));
					component.startDrag(true, new Rectangle(lpoint.x - bgcpoint.x + lbtn.width, 0, bgc.width - lbtn.x - lbtn.width, 0));
				}
			} 
			
			private function stopMove(event:Event):void  
			{				
				stage.removeEventListener(MouseEvent.MOUSE_UP, this.stopMove);
				stopDrag();
				
				var bgcpoint:Point = bgc.contentToLocal(new Point(bgc.x, bgc.y));
				var point:Point;
				var x:Number;
				var lx:Number;
				var rx:Number;
				
				point = lbtn.contentToLocal(new Point(lbtn.x, lbtn.y));		
				lx = point.x + lbtn.width;
				
				point = rbtn.contentToLocal(new Point(rbtn.x, rbtn.y));		
				rx = point.x;
				
				if ( _bLeftBtn )
					x = lx;
				else
					x = rx;
				
				var p:Number = (x - bgcpoint.x) / bgc.width;
				var time:Number = p * this._duration;
				this._player.seek(time + 4);
				
				
				time = (lx - bgcpoint.x) / bgc.width * this._duration; 
				var timeR:Number = (rx - bgcpoint.x) / bgc.width * this._duration;
				var len:Number = timeR - time;
				trace("time:" + time + " len:" + len);
				var jsObj:Object = new Object;
				jsObj.time = time;
				jsObj.len = len;
				ExternalInterface.call("cutVideoInfo", jsObj);
			}
			
			private function lbtnDown(event:MouseEvent):void
			{
				_bLeftBtn = true;
				startMove(event);
			}
			
			private function rbtnDown(event:MouseEvent):void
			{
				_bLeftBtn = false;
				startMove(event);
			}
			
			protected function bgc_mouseMoveHandler(event:MouseEvent):void
			{
				var point:Point = bgc.localToGlobal(new Point(bgc.x, bgc.y));
				if ( ( event.stageX >= point.x && event.stageX <= (point.x + bgc.width) )
					&& ( event.stageY > point.y && event.stageY < (point.y + bgc.height) )
				)
				{
					var p:Number = ( event.stageX - point.x ) / bgc.width;
					var time:Number = p * this._duration;
					
					timeTip.text = Strings.digits(time);
					timeTip.x = event.stageX - timeTip.width / 2; 
					timeTip.visible = true;
					//trace ("in rect");
				}
				else
				{
					timeTip.visible = false;
					//trace ("not in rect");
				}
				//trace("event.stageX :" + event.stageX + " y:" + event.stageY);
			}
			
			private function onMouseOut(event:MouseEvent):void
			{
				timeTip.visible = false;
			}
			
		]]>
	</fx:Script>
	<fx:Declarations>
		<!-- 将非可视元素（例如服务、值对象）放在此处 -->
	</fx:Declarations>
	<s:Group width="100%" height="100%">
		<s:layout>
			<s:HorizontalLayout />
		</s:layout>
		<s:Label id="posTime" right="0" width="40" height="100%" backgroundColor="#0FFF97"
				 chromeColor="#FE0303" color="#FF0404" text="posTime" textAlign="center"
				 verticalAlign="middle"/>
		<s:Group width="100%" height="100%" >
			<s:layout>
				<s:HorizontalLayout gap="0" />
			</s:layout>
			
			<s:Group width="100%" height="100%" mouseOut="onMouseOut(event)">
				<s:Label id="bgc" backgroundColor="#222224" width="845" height="100%" verticalCenter="0"/>
				<s:Label id="fgc" backgroundColor="#cdcdcd" width="0" height="100%" verticalCenter="0"/>
				<s:Button id="lbtn" chromeColor="#FE6D03" width="10" height="100%" mouseDown="lbtnDown" />
				<s:Button id="rbtn" chromeColor="#FE6D03" width="10" height="100%" mouseDown="rbtnDown"/>
			</s:Group>
			
		</s:Group>
		<s:Label id="durTime" width="40" height="100%" backgroundColor="#FC9708" text="durTime"
				 textAlign="center" verticalAlign="middle"/>
		<!-- <s:Button id="doThg" height="100%" width="400" right="0" click="doThg_clickHandler(event)"/> -->
	</s:Group>
	<s:Label id="timeTip" text="11:11" backgroundColor="#3e3e3e" color="#cdcdcd" y="-35" width="55" height="22"
			 visible="false" textAlign="center" verticalAlign="middle" />
</s:Group>
